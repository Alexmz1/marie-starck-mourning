// Prisma schema for Marie Starck Floral Atelier
// Business: Flower arrangements, bouquets, funeral compositions, weddings, corporate

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Product categories
enum Category {
  DEUIL      // Deuil - crosses, hearts, crowns, cushions, casket sprays
  MARIAGE    // Mariage - bridal bouquets, decorations, centerpieces
  BOUTIQUE   // Boutique - gifts, fresh bouquets, plants
}

// Sous-catégories basées sur le header du site
enum SubCategory {
  // Deuil
  CROIX              // Croix
  COEUR              // Cœur
  COURONNE           // Couronne
  COUSSIN            // Coussin
  DESSUS_CERCUEIL    // Dessus de cercueil
  DEVANT_TOMBE       // Devant de tombe
  BOUQUET_GERBE      // Bouquet gerbe
  FORMES_SPECIALES   // Formes spéciales
  
  // Mariage
  BOUQUET_MARIEE     // Bouquet de mariée
  BOUTONNIERE        // Boutonnière
  CORSAGE            // Corsage
  CENTRE_TABLE       // Centre de table
  DECORATION_EGLISE  // Décoration d'église
  
  // Boutique
  COMPOSITION_OFFRIR // Composition à offrir
  BOUQUET_FRAIS      // Bouquet frais
  PLANTE_INTERIEUR   // Plante d'intérieur
  PLANTE_EXTERIEUR   // Plante d'extérieur
  CREATION_SAISONNIERE // Création saisonnière
}

enum Size {
  PETIT     // Petit
  MOYEN     // Moyen
  GRAND     // Grand
  TRES_GRAND // Très grand
}

enum Color {
  BLANC     // Blanc
  ROUGE     // Rouge
  ROSE      // Rose
  JAUNE     // Jaune
  ORANGE    // Orange
  VIOLET    // Violet
  BLEU      // Bleu
  MULTICOLORE // Multicolore
  NATUREL   // Couleurs naturelles
}

enum OrderStatus {
  PENDING     // En attente
  CONFIRMED   // Confirmée
  IN_PROGRESS // En cours de préparation
  READY       // Prête
  DELIVERED   // Livrée
  CANCELLED   // Annulée
}

enum CustomerType {
  INDIVIDUAL  // Particulier
  BUSINESS    // Entreprise
}

// Core models
model Product {
  id          String      @id @default(cuid())
  name        String      // Nom du produit
  description String?     // Description du produit
  category    Category    // Catégorie principale (Deuil, Mariage, Boutique)
  subCategory SubCategory // Sous-catégorie (celles du header)
  images      String[]    // Array of image URLs
  inStock     Boolean     @default(true)
  featured    Boolean     @default(false)
  
  // SEO
  slug        String      @unique
  metaTitle   String?
  metaDescription String?
  
  // Timestamps
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // Relations - Prix variables selon taille
  productVariants ProductVariant[]
  // Couleurs disponibles pour ce produit
  productColors   ProductColor[]
  orderItems      OrderItem[]
  
  @@map("products")
}

// Table pour gérer les prix selon les tailles
model ProductVariant {
  id        String @id @default(cuid())
  productId String
  size      Size   // Taille du produit
  price     Float  // Prix pour cette taille
  
  // Relations
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@unique([productId, size]) // Un produit ne peut avoir qu'un seul prix par taille
  @@map("product_variants")
}

// Table pour gérer les couleurs disponibles par produit
model ProductColor {
  id        String @id @default(cuid())
  productId String
  color     Color  // Couleur disponible
  
  // Relations
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@unique([productId, color]) // Une couleur ne peut être ajoutée qu'une fois par produit
  @@map("product_colors")
}

model Customer {
  id           String       @id @default(cuid())
  firstName    String
  lastName     String
  email        String       @unique
  phone        String
  type         CustomerType @default(INDIVIDUAL)
  
  // Business customers
  companyName  String?
  siret        String?
  
  // Address
  address      String?
  city         String?
  postalCode   String?
  
  // Timestamps
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  
  // Relations
  orders       Order[]
  subscriptions Subscription[]
  
  @@map("customers")
}

model Order {
  id           String      @id @default(cuid())
  orderNumber  String      @unique
  status       OrderStatus @default(PENDING)
  
  // Customer info
  customerId   String
  customer     Customer    @relation(fields: [customerId], references: [id])
  
  // Delivery info
  deliveryDate DateTime?
  deliveryAddress String?
  deliveryCity    String?
  deliveryPostalCode String?
  deliveryInstructions String?
  
  // Funeral specific
  deceasedName String?     // Nom du défunt
  ceremonyDate DateTime?   // Date de cérémonie
  
  // Wedding specific
  weddingDate  DateTime?
  venue        String?     // Lieu de réception
  
  // Pricing
  subtotal     Float
  deliveryFee  Float       @default(0)
  total        Float
  
  // Payment
  paymentMethod String?
  paymentStatus String?    @default("pending")
  
  // Notes
  notes        String?
  
  // Timestamps
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  
  // Relations
  items        OrderItem[]
  
  @@map("orders")
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId String
  product   Product @relation(fields: [productId], references: [id])
  
  quantity  Int     @default(1)
  unitPrice Float   // Prix unitaire selon la taille choisie
  total     Float
  
  // Choix du client
  selectedSize  Size?  // Taille choisie par le client
  selectedColor Color? // Couleur choisie par le client
  
  // Custom requirements
  customMessage String? // Message personnalisé pour les cartes
  
  @@map("order_items")
}

// Corporate subscriptions
model Subscription {
  id           String   @id @default(cuid())
  customerId   String
  customer     Customer @relation(fields: [customerId], references: [id])
  
  name         String   // Ex: "Abonnement bureau mensuel"
  frequency    String   // "weekly", "monthly", "quarterly"
  startDate    DateTime
  endDate      DateTime?
  isActive     Boolean  @default(true)
  
  // Pricing
  monthlyPrice Float
  
  // Delivery info
  deliveryAddress String
  deliveryInstructions String?
  
  // Timestamps
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@map("subscriptions")
}

// Contact forms and inquiries
model Inquiry {
  id          String       @id @default(cuid())
  type        CustomerType @default(INDIVIDUAL)
  
  // Contact info
  firstName   String
  lastName    String?
  email       String
  phone       String
  companyName String?      // For business inquiries
  
  // Inquiry details
  subject     String
  message     String
  category    Category?
  services    String[]     // Interested services for business
  contactPreference String? // "phone", "email", "meeting"
  
  // Status
  status      String       @default("new") // "new", "contacted", "quoted", "closed"
  
  // Timestamps
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  @@map("inquiries")
}
