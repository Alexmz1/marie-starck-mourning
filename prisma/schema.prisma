generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id              String           @id @default(cuid())
  name            String
  description     String?
  category        Category
  subCategory     SubCategory
  images          String[]
  imageKeys       String[]
  inStock         Boolean          @default(true)
  featured        Boolean          @default(false)
  slug            String           @unique
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  orderItems      OrderItem[]
  productColors   ProductColor[]
  productVariants ProductVariant[]

  @@map("products")
}

model ProductVariant {
  id        String  @id @default(cuid())
  productId String
  size      Size
  price     Float
  height    Float?
  width     Float?
  depth     Float?
  diameter  Float?
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, size])
  @@map("product_variants")
}

model ProductColor {
  id        String  @id @default(cuid())
  productId String
  color     Color
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, color])
  @@map("product_colors")
}

model Customer {
  id            String         @id @default(cuid())
  firstName     String
  lastName      String
  email         String         @unique
  phone         String
  type          CustomerType   @default(INDIVIDUAL)
  companyName   String?
  siret         String?
  address       String?
  city          String?
  postalCode    String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  orders        Order[]
  subscriptions Subscription[]

  @@map("customers")
}

model Order {
  id                   String      @id @default(cuid())
  orderNumber          String      @unique
  status               OrderStatus @default(PENDING)
  customerId           String?
  
  // Données Stripe
  stripeSessionId      String?     @unique
  stripePaymentIntentId String?    @unique
  
  // Informations client (si pas de Customer créé)
  customerEmail        String?
  customerFirstName    String?
  customerLastName     String?
  customerPhone        String?
  
  // Livraison
  deliveryType         DeliveryType @default(DELIVERY)
  deliveryDate         DateTime?
  deliveryAddress      String?
  deliveryCity         String?
  deliveryPostalCode   String?
  deliveryInstructions String?
  
  // Événements spéciaux
  deceasedName         String?
  ceremonyDate         DateTime?
  weddingDate          DateTime?
  venue                String?
  
  // Montants
  subtotal             Float
  deliveryFee          Float       @default(0)
  total                Float
  
  // Paiement
  paymentMethod        String?     @default("stripe")
  paymentStatus        String?     @default("pending")
  currency             String      @default("eur")
  
  notes                String?
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt
  items                OrderItem[]
  customer             Customer?   @relation(fields: [customerId], references: [id])

  @@map("orders")
}

model OrderItem {
  id            String  @id @default(cuid())
  orderId       String
  productId     String?
  
  // Données du produit (au moment de la commande)
  productName   String
  productImage  String?
  
  quantity      Int     @default(1)
  unitPrice     Float
  totalPrice    Float
  
  // Variantes sélectionnées
  selectedSize  String?
  selectedColor String?
  
  // Options personnalisées
  customMessage String?
  ribbonText    String?
  hasRibbon     Boolean @default(false)
  
  order         Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product       Product? @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model Subscription {
  id                   String    @id @default(cuid())
  customerId           String
  name                 String
  frequency            String
  startDate            DateTime
  endDate              DateTime?
  isActive             Boolean   @default(true)
  monthlyPrice         Float
  deliveryAddress      String
  deliveryInstructions String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  customer             Customer  @relation(fields: [customerId], references: [id])

  @@map("subscriptions")
}

model Inquiry {
  id                String       @id @default(cuid())
  type              CustomerType @default(INDIVIDUAL)
  firstName         String
  lastName          String?
  email             String
  phone             String
  companyName       String?
  subject           String
  message           String
  category          Category?
  services          String[]
  contactPreference String?
  status            String       @default("new")
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@map("inquiries")
}

enum Category {
  DEUIL
  MARIAGE
  BOUTIQUE
}

enum SubCategory {
  CROIX
  COEUR
  COURONNE
  COUSSIN
  DESSUS_CERCUEIL
  DEVANT_TOMBE
  BOUQUET_GERBE
  FORMES_SPECIALES
  BOUQUET_MARIEE
  BOUTONNIERE
  CORSAGE
  CENTRE_TABLE
  DECORATION_EGLISE
  PRODUIT_SAISON
  COMPOSITION_OFFRIR
  BOUQUET_FRAIS
  PLANTE_INTERIEUR
  PLANTE_EXTERIEUR
}

enum Size {
  PETIT
  MOYEN
  GRAND
  TRES_GRAND
}

enum Color {
  MULTICOLORE
  BLANC
  ROSE_PALE
  ROSE_FUSHIA
  ROUGE
  BLEU_VIOLET
  JAUNE
  ORANGE
}

enum OrderStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  READY
  DELIVERED
  CANCELLED
}

enum CustomerType {
  INDIVIDUAL
  BUSINESS
}

enum DeliveryType {
  DELIVERY
  PICKUP
}
